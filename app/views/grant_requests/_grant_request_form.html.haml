- form.object.program_organization_lookup = (form.object.program_organization ? form.object.program_organization.name : '')
- form.object.fiscal_organization_lookup = (form.object.fiscal_organization ? form.object.fiscal_organization.name : '')
= form.input :program_organization_lookup, :label => "Program Organization", :as => :autocomplete, :autocomplete_url => organizations_path(:format => :json, :parent_org_id => 0, :name_method => 'to_s'), :related_attribute_name => :name, :input_html => {:class => 'program_organization_lookup_select', 'data-related-child' => ".program-org-sat-select"}
- program_organization_satellites = form.object.program_organization ? form.object.program_organization.satellites : []
= form.input :program_organization, :label => 'Location: ', :as => :select, :input_html => {:class => 'program-org-sat-select', 'data-param'.to_sym => 'related_org_ids', 'data-src'.to_sym => organizations_path(:format => 'json'), 'data-cache'.to_sym => 'org_sat_select', 'data-required' => '1', 'data-related-child' => '.program-org-contact,.program-org-signatory'}, :collection => program_organization_satellites.map {|org| [org.name, org.id]}

- program_users = []
- program_users = form.object.program_organization.users if form.object.program_organization
= form.input :grantee_org_owner, :label => 'Primary Contact', :as => :select, :collection => program_users, :input_html => {:class => 'program-org-contact', 'data-cache'.to_sym => 'program_contact_select', 'data-required' => 1, 'data-src'.to_sym => users_path(:format => 'json'), 'data-param'.to_sym => 'organization_id'}
= form.input :grantee_signatory, :label => 'Primary Signatory', :as => :select, :collection => program_users, :input_html => {:class => 'program-org-signatory', 'data-cache'.to_sym => 'program_signatory_select', 'data-required' => 1, 'data-src'.to_sym => users_path(:format => 'json'), 'data-param'.to_sym => 'organization_id'}

= form.input :fiscal_organization_lookup, :label => "Fiscal Organization", :as => :autocomplete, :autocomplete_url => organizations_path(:format => :json, :parent_org_id => 0, :name_method => 'to_s'), :related_attribute_name => :name, :input_html => {:class => 'fiscal_organization_lookup_select', 'data-related-child' => ".fiscal-org-sat-select"}, :value => (form.object.fiscal_organization ? form.object.fiscal_organization.name : '')
- fiscal_organization_satellites = form.object.fiscal_organization ? form.object.fiscal_organization.satellites : []
= form.input :fiscal_organization, :label => 'Location: ', :as => :select, :input_html => {:class => 'fiscal-org-sat-select', 'data-param'.to_sym => 'related_org_ids', 'data-src'.to_sym => organizations_path(:format => 'json'), 'data-cache'.to_sym => 'org_sat_select', 'data-required' => '1', 'data-related-child' => '.fiscal-org-contact,.fiscal-org-signatory'}, :collection => fiscal_organization_satellites.map {|org| [org.name, org.id]}

- fiscal_users = []
- fiscal_users = form.object.fiscal_organization.users if form.object.fiscal_organization
= form.input :fiscal_org_owner, :label => 'Fiscal Contact', :as => :select, :collection => fiscal_users, :input_html => {:class => 'fiscal-org-contact', 'data-cache'.to_sym => 'fiscal_contact_select', 'data-required' => 1, 'data-src'.to_sym => users_path(:format => 'json'), 'data-param'.to_sym => 'organization_id'}
= form.input :fiscal_signatory, :label => 'Fiscal Signatory', :as => :select, :collection => fiscal_users, :input_html => {:class => 'fiscal-org-signatory', 'data-cache'.to_sym => 'fiscal_signatory_select', 'data-required' => 1, 'data-src'.to_sym => users_path(:format => 'json'), 'data-param'.to_sym => 'organization_id'}

= form.input :amount_requested, :label => "Amount Requested" if model.state_in(GrantRequest.pre_recommended_chain + Request.grant_states)

= form.input :program, :label => "Program", :as => :select, :collection => Program.all.map{|program| [program.name, program.id]}, :input_html => {:class => 'program-dropdown-select', 'data-related-child' => ".program-lead-select"}
- program_leads = []
- program_leads = form.object.program.load_users if form.object.program
= form.input :program_lead, :label => "Program Lead", :as => :select, :collection => program_leads.map{|user| [user.full_name, user.id]}, :input_html => {:class => 'program-lead-select', 'data-param'.to_sym => 'program_id', 'data-src'.to_sym => users_path(:format => 'json'), 'data-cache'.to_sym => 'program_lead_select'}

= form.input :initiative, :label => "Initiative", :as => :select, :collection => Initiative.all.map{|initiative| [initiative.name, initiative.id]}

= form.input :project_summary, :label => "Project Summary", :as => :text

= render :partial => "model_documents/list_model_documents", :locals => { :model => model} unless model.state_in(GrantRequest.new_states)
= render(:partial => "grant_requests/approve_grant_details", :locals => { :model => model, :form => form}) if model.state_in(Request.grant_states)

- unless model.state_in GrantRequest.new_states
  = form.input :funding_general_operating_support, :label => "This grant is funding general operating support.", :label_class=>'wide_label'
  = form.input :board_authorization_required, :label => "This grant required direct board authority.", :label_class=>'wide_label'
  = form.input :renewal_grant, :label => "This grant is a renewal.", :label_class=>'wide_label'
  = form.input :initiative_types, :label => "Initiative types.", :label_class=>''
  = form.input(:amount_recommended, :label => "Recommended amount to fund.", :label_class=>'') if model.state_in(GrantRequest.new_states + GrantRequest.pre_recommended_chain + GrantRequest.approval_chain.up_to(:pending_president_approval) + GrantRequest.sent_back_states + Request.grant_states)
  = form.input :duration_in_months, {:label => 'Duration (months):', :as => :select, :collection => (1..36).to_a, :input_html => {:class => 'select_short'}}
  = form.input :ierf_start_at, :label => "Start Date:"
  = form.input :ierf_proposed_end_at, :label => "Final Proposal Date:"
  = form.input :ierf_budget_end_at, :label => "Final Budget Date:"
  -# TODO ESH: = render :partial => "grant_requests/funding_sources", :locals => { :model => model, :form => form}
  = form.input :constituents, :label => "Consituents:", :as => :select, :wrapper_html => {:class => 'multiple-select-transfer'}
  = form.input :usa_means, :label => "Means:", :as => :select, :wrapper_html => {:class => 'multiple-select-transfer'}
  = form.input :china_means, :label => "Type of Organization (China use only):", :as => :select, :wrapper_html => {:class => 'multiple-select-transfer'}

- unless model.state_in GrantRequest.new_states
  = form.input :ierf_goals, :label => "Goals: How does this grant or cluster of grants fit into your logic model?  What will this grant or cluster of grants accomplish if it is successful?", :label_class=>'wide_label'
  = form.input :ierf_tactics, :label => "Tactics: What are the primary means the grantee(s) will use?  How are the tactics linked to the strategy?", :label_class=>'wide_label'
  = form.input :ierf_probability, :label => "Probability: What is the likelihood that the grantee(s) will succeed in the tactics they lay out?  What are the possible failure scenarios?", :label_class=>'wide_label'

- unless model.state_in GrantRequest.new_states
  = form.input :ierf_due_diligence_overlap, :label => "Does this grant overlap with other sectors or key funders?  If so, please explain which sectors/funder, and provide any scheduled meetings.", :label_class=>'wide_label'
  = form.input :ierf_due_diligence_risks, :label => "Does this grant pose any institutional risks to EF?  If yes, please explain how these issues will be addressed.", :label_class=>'wide_label'
  = form.input :ierf_due_diligence_noc4_work, :label => "Have you carefully reviewed the proposal and budget to make sure that they contain no C4 work?", :label_class=>'wide_label'
  = form.input :ierf_due_diligence_board_review, :label => "Does this grant warrant input and/or review by board members?  If yes, please list board member name and any related information.", :label_class=>'wide_label'

= form.commit_button