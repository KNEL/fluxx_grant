- request = nil unless defined?(:request)
- unless request
  - if params[:request_id]
    - request = BlobStruct.new :id => params[:request_id], :class => Request
%h3
  = "Funding Sources"
  %span.actions= link_to image_tag('/images/fluxx_engine/theme/default/icons/add.png', :class=> 'add-button'), new_request_funding_source_path(:request_funding_source => {:request_id => model.id}), :class => 'to-modal', 'data-on-success' => 'refreshCaller,close' if params[:skip_wrapper] || (@edit_funding_sources_enabled && current_user.has_create_for_model?(RequestFundingSource))

- if !models || models.empty?
  %p= "No funding sources available"
- else
  - total = 0
  - models.each do |funding_source| 
    - total += funding_source.funding_amount if funding_source.funding_amount
    %div.content
      .pairs
        .key= "Amount:"
        .value
          - if @edit_funding_sources_enabled
            = link_to "#{number_to_currency funding_source.funding_amount}", edit_request_funding_source_path(funding_source), :class => 'to-modal', 'data-on-success' => 'refreshCaller,close'
          - else
            = number_to_currency funding_source.funding_amount 
      .pairs
        .key= "Source:"
        .value= funding_source.funding_source.name if funding_source.funding_source
      .pairs
        .key= "Initiatives:" 
        .value
          -  program_names = []
          -  program_names << funding_source.program.name if funding_source.program
          -  program_names << funding_source.initiative.name if funding_source.initiative
          = program_names.join ', '
      .pairs
        .key= 'Total Funding'
        .value= number_to_currency total
      <hr/>
      %span.actions
        - if current_user.has_delete_for_model?(funding_source)
          = link_to image_tag("/images/fluxx_engine/theme/default/icons/delete.png", :class => 'delete-button'), funding_source, :class => 'as-delete', 'data-on-success' => 'refreshCaller' if @edit_funding_sources_enabled
